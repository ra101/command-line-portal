class Shell{constructor(t,e){this.commands=e,this.setupListeners(t),this.term=t,localStorage.directory="root",localStorage.history=JSON.stringify(""),localStorage.historyIndex=-1,localStorage.inHistory=!1,$(".input").focus()}setupListeners(t){$("#terminal").mouseup((()=>$(".input").last().focus())),t.addEventListener("keyup",(t=>{const e=38,o=40,s=t.keyCode;if([e,o].includes(s)){let r=localStorage.history;if(r=r?Object.values(JSON.parse(r)):[],s===e)localStorage.historyIndex>=0&&("false"==localStorage.inHistory&&(localStorage.inHistory=!0),localStorage.historyIndex==r.length-1&&1!==r.length&&(localStorage.historyIndex-=1),$(".input").last().html(`${r[localStorage.historyIndex]}<span class="end"><span>`),0!=localStorage.historyIndex&&(localStorage.historyIndex-=1));else if(s===o&&"true"==localStorage.inHistory&&localStorage.historyIndex<r.length){let t;localStorage.historyIndex>0?(t=`${r[localStorage.historyIndex]}<span class="end"><span>`,localStorage.historyIndex!=r.length-1&&(localStorage.historyIndex=Number(localStorage.historyIndex)+1)):0==localStorage.historyIndex&&r.length>1&&(t=`${r[1]}<span class="end"><span>`,localStorage.historyIndex=2!==r.length?2:1),$(".input").last().html(t)}t.preventDefault(),$(".end").focus()}})),t.addEventListener("keydown",(t=>{9===t.keyCode?t.preventDefault():8!==t.keyCode&&46!==t.keyCode||this.resetHistoryIndex()})),t.addEventListener("keypress",(e=>{if([9,27,37,38,39,40].includes(e.keyCode)||this.resetHistoryIndex(),13===e.keyCode){const o=e.target,s=o.textContent.trim().split(" "),r=s[0].toLowerCase(),n=s[1];"clear"===r||"cls"===r?(this.updateHistory(r),this.clearConsole()):"cd.."===r&&null==n?(this.runCommand("cd",".."),this.resetPrompt(t,o),$(".root").last().html("root"==localStorage.directory?"~":localStorage.directory)):"echo"===r||"printf"===r?(this.runCommand(r,s.slice(1,s.length).join(" ")),this.resetPrompt(t,o)):["exit","shutdown","quit"].includes(r)?this.runCommand(r,o):r&&r in this.commands?(this.runCommand(r,n),this.resetPrompt(t,o),$(".root").last().html("root"==localStorage.directory?"~":localStorage.directory)):(""==s||(this.term.innerHTML+="Error: command not recognized"),this.resetPrompt(t,o)),e.preventDefault()}}))}runCommand(t,e){const o=e?`${t} ${e}`:t;this.updateHistory(o);const s=this.commands[t](e);s&&(this.term.innerHTML+=s),$("pre#pre-ra").on("animationend",(function(){$(this).removeClass("fade-in")}))}resetPrompt(t,e){const o=e.parentNode.cloneNode(!0);e.setAttribute("contenteditable",!1),this.prompt&&(o.querySelector(".prompt").textContent=this.prompt),t.appendChild(o),o.querySelector(".input").innerHTML="",o.querySelector(".input").focus()}resetHistoryIndex(){let t=localStorage.history;t=t?Object.values(JSON.parse(t)):[],1==localStorage.goingThroughHistory&&(localStorage.goingThroughHistory=!1),0==t.length?localStorage.historyIndex=-1:localStorage.historyIndex=t.length-1>0?t.length-1:0}updateHistory(t){let e=localStorage.history;e=e?Object.values(JSON.parse(e)):[],e.push(t),localStorage.history=JSON.stringify(e),localStorage.historyIndex=e.length-1}clearConsole(){const t=()=>localStorage.directory,e="root"==t()?"~":t();$("#terminal").html(`\n      <p> <span class="green-glow">(ᵔᵕᵔ)/</span> - WELCOME TO <span class="root">〈 RA 〉's Console</span>! TYPE \`<span class="tick">help</span>\` TO GET STARTED. </p>\n      <p class="hidden">\n          <span class="prompt">\n            <span class="root">${e}</span>\n            <span class="tick">$</span>\n          </span>\n          <span contenteditable="true" class="input"></span>\n      </p>`),$(".input").focus()}}
